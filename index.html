<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta http-equiv="Access-Control-Allow-Origin" content="*" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="%VITE_SITE_LOGO%" />
    <link rel="apple-touch-icon" href="%VITE_SITE_APPLE_LOGO%" />
    <link rel="bookmark" href="%VITE_SITE_APPLE_LOGO%" />
    <link rel="apple-touch-icon-precomposed" sizes="200x200" href="%VITE_SITE_APPLE_LOGO%" />
    <meta name="description" content="%VITE_SITE_DES%" />
    <meta name="keywords" content="%VITE_SITE_KEYWORDS%" />
    <meta name="author" content="%VITE_SITE_AUTHOR%" />
    <meta name="theme-color" content="#424242" />
    <title>%VITE_SITE_NAME%</title>
    <link rel="stylesheet" href="https://s1.hdslb.com/bfs/static/jinkela/long/font/regular.css" />
    <script>
      if (/*@cc_on!@*/ false || (!!window.MSInputMethodContext && !!document.documentMode))
        window.location.href =
          'https://support.dmeng.net/upgrade-your-browser.html?referrer=' +
          encodeURIComponent(window.location.href);
    </script>
  </head>

 <body>
    <div id="app"></div>
    <noscript>
      <div style="text-align: center">è¯·å¼€å¯ JavaScript</div>
    </noscript>
    <script type="module" src="/src/main.js"></script>

    <!-- ğŸ‘‡ğŸ‘‡ğŸ‘‡ ä¸´æ—¶æ•‘æ€¥ï¼šåŸç”Ÿ HTML æŒ‰é’®ï¼ˆä¸ä¾èµ– Vueï¼‰ ğŸ‘‡ğŸ‘‡ğŸ‘‡ -->
    <!-- åªæœ‰å½“ Vue æ²¡åŠ è½½å‡ºæ¥ï¼Œæˆ–è€… SW å¡æ­»æ—¶ï¼Œè¿™ä¸ªæŒ‰é’®èƒ½æ•‘å‘½ -->
    <div id="emergency-fix-btn" style="display: none;">
        <button onclick="window.nukeCacheAndReload && window.nukeCacheAndReload(window.configHomeUrl)" style="
            position: fixed; bottom: 100px; right: 20px; z-index: 999999;
            padding: 10px 20px; background: red; color: white; border: none; border-radius: 5px;
        ">
            ä¿®å¤è·³è½¬(æ•‘æ€¥)
        </button>
    </div>

    <script>
      (function() {
        // 1. å®šä¹‰ç›®æ ‡åŸŸå (è¯·æ‰‹åŠ¨æŠŠè¿™é‡Œçš„ç½‘å€æ”¹æˆä½ çš„æ­£ç¡®åŸŸå)
        var TARGET_HOME = "https://www.tming.cn/"; 
        window.configHomeUrl = TARGET_HOME;

        // 2. åˆ¤æ–­é€»è¾‘
        var isOld = window.location.hostname === 'tming.cn';
        
        // 3. æ˜¾ç¤ºåŸç”ŸæŒ‰é’®
        if (isOld) {
            var btn = document.getElementById('emergency-fix-btn');
            if(btn) btn.style.display = 'block';
        }

        // 4. æ¸…ç†å‡½æ•°
        window.nukeCacheAndReload = async function(targetUrl) {
            if(!confirm("å¾®ä¿¡ç¼“å­˜é¡½å›ºï¼Œç¡®å®šå¼ºåŠ›ä¿®å¤å¹¶è·³è½¬ï¼Ÿ")) return;
            var dest = targetUrl || TARGET_HOME;
            var finalUrl = dest + '?t=' + new Date().getTime();

            try {
                if (navigator.serviceWorker) {
                    var regs = await navigator.serviceWorker.getRegistrations();
                    for (var i = 0; i < regs.length; i++) await regs[i].unregister();
                }
                if (window.caches) {
                    var keys = await caches.keys();
                    for (var i = 0; i < keys.length; i++) await caches.delete(keys[i]);
                }
                localStorage.clear();
                sessionStorage.clear();
                window.location.replace(finalUrl);
            } catch (e) {
                window.location.replace(finalUrl);
            }
        };
      })();
    </script>
  </body>
</html>
